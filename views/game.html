<!DOCTYPE html>
<html>
    <head>
		<script src="/socket.io/socket.io.js"></script>
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
		<script src="//code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="../css/game.css" />
	</head>
        <body>
			<div style="background-color: blanchedalmond; width: 500px; height: 500px;">
				<canvas id="Player" width="500px" height="500px" style="position: absolute;"></canvas>
				<canvas id="Player2" width="500px" height="500px" style="position: absolute;"></canvas>
				<canvas id="Map" width="500px" height="500px" style="position: absolute;"></canvas>
			</div>
			<div class="chatdiv">
				<div id="chat" style="float: left; height:300px; width: 500px; border: 1px solid silver; overflow: scroll;"></div>
				<form id="SendForm">
				<input id="Message">
				<input type="submit">
			</form></div>
		</body>
		<script>
		jQuery(function($){
		var socket = io.connect();
		/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
		++++++++++++++++++++++++++++++++++++++++++++++++CHAT FUNCTIONS AND SOCKETS+++++++++++++++++++++++
		+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
		$('#SendForm').submit(function(e){
                e.preventDefault();
                socket.emit('Data', $('#Message').val(), function(data){
                 $("#chat").append('<span class="error"><b>'+ data + '<span></br>');
                //socket.emit('Ressource', $Ressource.html());
                // Var A wird um + erhöht, übergabe P2 ist falsch...
                });
                //$("#chat").scrollTop($("#chat")[0].scrollHeight);
                $("#chat").animate({scrollTop:$("#chat")[0].scrollHeight}, 500);
                $('#Message').val('');
                //Server sendet hier wirde empfangen (Socket.on)
                //Chat Socket
		});
		socket.on('ServerMessege', function(data){
                     $("#chat").append('<span class="error">'+data+'</span></br>');
                     $("#chat").animate({scrollTop:$("#chat")[0].scrollHeight}, 500);
                });
		socket.on('message', function(data){
                     $("#chat").append('<span class="msg"><b>'+ data.nick + '</b>: ' + data.msg + '<span></br>');
                     $("#chat").animate({scrollTop:$("#chat")[0].scrollHeight}, 500);
        });
        socket.on('whisper', function(data){
                    $("#chat").append('<span class="whisper"><b>'+ data.nick + '</b>: ' + data.msg + '<span></br>');
                    $("#chat").animate({scrollTop:$("#chat")[0].scrollHeight}, 500);
        });
		/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
		++++++++++++++++++++++++++++++++++++++++++++++++GAME SOCKETS+++++++++++++++++++++++++++++++++++++
		+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
		//Testing for Server Site Objekt Creator
		var e=document.getElementById("Player");
		var canv=e.getContext("2d");
		canv.fillStyle = "rgb(200,0,0)";
		canv.fillRect (0, 450, 400, 30);
					
socket.on('PlayerSpawn', function(PlayerCooordsX, PlayerCooordsY, PlayerPosition){
		console.log(PlayerPosition);
					if(PlayerPosition == 1){
					var e=document.getElementById("Player");
					var canv=e.getContext("2d");
					}else if(PlayerPosition == 2){
					var e=document.getElementById("Player2");
					var canv=e.getContext("2d");
					}
					canv.fillStyle = "rgb(200,0,0)";
					canv.fillRect (PlayerCooordsX, PlayerCooordsY, 50, 50);
});
socket.on('PlayerMovment', function(PlayerCooordsX, PlayerCooordsY, PlayerPosition, Direction){
console.log(PlayerPosition+" Hat Movment ausgelöst");
	if(PlayerPosition == 1){
			var e=document.getElementById("Player");
			var canv=e.getContext("2d");
		}else if(PlayerPosition == 2){
			var e=document.getElementById("Player2");
			var canv=e.getContext("2d");
		}
		if(Direction == "Left"){
				PlayerCooordsX = PlayerCooordsX + 1; // Sende Old Positionen Mit
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsX = PlayerCooordsX - 1;
		}else if(Direction == "Down"){
				PlayerCooordsY--;
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsY++;
		}else if(Direction == "Right"){
				PlayerCooordsX--;
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsX++;
		}else if(Direction == "Jump"){
				PlayerCooordsY++;
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsY--;
		}else if(Direction == "JumpLeft"){
				//X UND Y COORDS BEHANDELN!
				PlayerCooordsY++;
				PlayerCooordsX++;
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsY--;
				PlayerCooordsX--;
		}else if(Direction == "JumpRight"){
				//X UND Y COORDS BEHANDELN!
				PlayerCooordsY++;
				PlayerCooordsX--;
				canv.clearRect(PlayerCooordsX,PlayerCooordsY,50,50);
				PlayerCooordsY--;
				PlayerCooordsX++;
		}
		canv.fillStyle = "rgb(200,0,0)";
		canv.fillRect(PlayerCooordsX,PlayerCooordsY,50,50);
});	
var keys = {};

/*
$(document).keydown(function (e) {
    keys[e.which] = true;
	console.log(e);
});

$(document).keyup(function (e) {
    delete keys[e.which];
});	*/	

Keys = [];
$(document).keydown(function(event) {
//Speichere den angeforderten Key
if( Keys.indexOf(event.keyCode) > 0 ){
console.log("Existiert bereits");
console.log(Keys);
}else{
Keys.push(event.keyCode);
console.log(Keys);
}
	//Keys in array laden, bei jedem aufruf dieses array abfragen, somit kann ermittelt werden ob noch eine weitere Taste gedrückt wurde!
	//Else Anweisungen noch schreiben
	//Prüfen ob der Wert im Array schon exiistiert wen ja schreibe nicht ins array. (scheint noch buggy zu sein checken)
			if(event.which === 65 || Keys[0] === 65 || Keys[1] === 65 || Keys[2] === 65 || Keys[3] === 65 || Keys[4] === 65) {
			//Move Left 65
				socket.emit("PlayerMovment", "Left");
			}
			if(event.which === 83){
			//Move Down
				socket.emit("PlayerMovment", "Down");
			}
			if(event.which === 68 || Keys[0] === 68 || Keys[1] === 68 || Keys[2] === 68 || Keys[3] === 68 || Keys[4] === 68){
			//Move Right
				socket.emit("PlayerMovment", "Right");
			}
			if(event.which === 87 || Keys[0] === 87 || Keys[1] === 87 || Keys[2] === 87 || Keys[3] === 87 || Keys[4] === 87){
			//Move - Jump
				socket.emit("PlayerMovment", "Jump");
			}
			if(Keys[0] === 81 || Keys[1] === 81 || Keys[2] === 81 || Keys[3] === 81 || Keys[4] === 81 && Keys[0] === 87 || Keys[1] === 87 || Keys[2] === 87 || Keys[3] === 87 || Keys[4] === 87){
			//Move - JumpLeft
				console.log("SPRING IN EINEM WINKEL! JUMPLEFT");
				socket.emit("PlayerMovment", "JumpLeft");
			}
			if(event.which ===  69 && event.which === 87){
			//Move - JumpRight
				socket.emit("PlayerMovment", "JumpRight");
				console.log("SPRING IN EINEM WINKEL! JUMPRIGHT");
			}
});
$(document).keyup(function(event) {
//DELETE Taste
	var removeItem = event.keyCode;

	Keys = jQuery.grep(Keys, function(value) {
		return value != removeItem;
	});

});			
/*var map = []; // Or you could call it "key"
onkeydown = onkeyup = function(event){
    event = event || event; // to deal with IE
    map[event.keyCode] = event.type == 'keydown';
    insert conditional here
			if(map[65]) {
			//Move Left 65
				socket.emit("PlayerMovment", "Left");
			}else if(map[83]){
			//Move Down
				socket.emit("PlayerMovment", "Down");
			}else if(map[68]){
			//Move Right
				socket.emit("PlayerMovment", "Right");
			}else if(map[87]){
			//Move - Jump
				socket.emit("PlayerMovment", "Jump");
			}else if(map[81] && map[87]){
			//Move - JumpLeft
				console.log("SPRING IN EINEM WINKEL! JUMPLEFT");
				socket.emit("PlayerMovment", "JumpLeft");
			}else if(map[69] && map[87]){
			//Move - JumpRight
				socket.emit("PlayerMovment", "JumpRight");
				console.log("SPRING IN EINEM WINKEL! JUMPRIGHT");
			}
}*/
			
			
			});                   //  start the loop
</script>
</html>